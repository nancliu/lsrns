# 工程结构优化实施TODO清单

## 📋 **总体进度跟踪**

- [ ] **阶段1: 基础架构搭建** (第1-2周) - 0%
- [ ] **阶段2: 数据迁移和兼容性** (第3-4周) - 0%
- [ ] **阶段3: 功能迁移和优化** (第5-6周) - 0%
- [ ] **阶段4: 测试和优化** (第7-8周) - 0%
- [ ] **阶段5: 部署和监控** (第9周) - 0%

---

## 🏗️ **阶段1: 基础架构搭建 (第1-2周)**

### **1.1 创建新的目录结构**

#### **核心目录创建**

- [ ] 创建 `cases/` 目录
- [ ] 创建 `templates/` 目录及其子目录
  - [ ] `templates/taz_files/`
  - [ ] `templates/network_files/`
  - [ ] `templates/config_templates/`
    - [ ] `templates/config_templates/simulation_templates/`
    - [ ] `templates/config_templates/vehicle_templates/`
    - [ ] `templates/config_templates/detector_templates/`
- [ ] 创建 `shared/` 目录及其子目录
  - [ ] `shared/e1_detectors/`
  - [ ] `shared/gantry_locations/`
  - [ ] `shared/analysis_tools/`
  - [ ] `shared/data_processors/`
  - [ ] `shared/utilities/`
    - [ ] `shared/utilities/taz_tools/`
- [ ] 创建 `api/` 目录结构（简化版本）
  - [ ] `api/main.py` - FastAPI主程序入口
  - [ ] `api/models.py` - 所有Pydantic数据模型
  - [ ] `api/routes.py` - 所有API路由
  - [ ] `api/services.py` - 业务逻辑
  - [ ] `api/utils.py` - 工具函数
- [ ] 创建 `frontend/` 目录结构
  - [ ] `frontend/test_pages/`
- [ ] 创建 `docs/` 目录结构
  - [ ] `docs/api_docs/`
  - [ ] `docs/user_guide/`
  - [ ] `docs/development/`

#### **模板文件迁移**

- [ ] 迁移现有TAZ文件到 `templates/taz_files/`
  - [ ] 移动 `TAZ_5_validated.add.xml`
  - [ ] 移动 `TAZ_4.add.xml`
  - [ ] 创建 `taz_templates.json`
- [ ] 迁移网络文件到 `templates/network_files/`
  - [ ] 移动 `sichuan202503v6.net.xml`
  - [ ] 移动 `sichuan202503v5.net.xml`
  - [ ] 创建 `network_configs.json`
- [ ] 迁移配置文件到 `templates/config_templates/`
  - [ ] 创建默认仿真配置模板
  - [ ] 创建中观仿真配置模板
  - [ ] 创建微观仿真配置模板
  - [ ] 移动 `vehicle_types.json`
  - [ ] 移动检测器配置文件

#### **共享资源迁移**

- [ ] 迁移E1检测器配置到 `shared/e1_detectors/`
- [ ] 迁移门架位置数据到 `shared/gantry_locations/`
- [ ] 迁移分析工具到 `shared/analysis_tools/`
- [ ] 迁移数据处理器到 `shared/data_processors/`
- [ ] 迁移通用工具到 `shared/utilities/`
- [ ] 迁移TAZ分析工具到 `shared/utilities/taz_tools/`
  - [ ] 移动 `analyze_duplicate_taz.py`
  - [ ] 移动 `compare_taz_files.py`
  - [ ] 移动 `fix_duplicate_taz.py`
  - [ ] 移动 `fix_taz.bat`
  - [ ] 移动 `taz_validator.py`
  - [ ] 移动 `README.md`
  - [ ] 创建 `output/` 子目录
  - [ ] 移动输出文件到 `output/` 目录

### **1.2 设计并实现案例元数据模型**

#### **元数据模型设计**

- [ ] 设计 `CaseMetadata` 数据模型
- [ ] 设计 `CaseCreationRequest` 请求模型
- [ ] 设计 `CaseStatus` 状态模型
- [ ] 设计 `CaseStatistics` 统计模型

#### **元数据管理功能**

- [ ] 实现元数据创建功能
- [ ] 实现元数据更新功能
- [ ] 实现元数据读取功能
- [ ] 实现元数据验证功能

### **1.3 实现基础的案例管理API（简化结构）**

#### **API文件结构创建**

- [ ] 创建 `api/main.py` - FastAPI应用入口
  - [ ] 配置FastAPI应用
  - [ ] 添加CORS中间件
  - [ ] 注册路由
- [ ] 创建 `api/models.py` - 数据模型
  - [ ] 迁移现有Pydantic模型
  - [ ] 添加新的案例管理模型
  - [ ] 添加请求/响应模型
- [ ] 创建 `api/routes.py` - API路由
  - [ ] 创建路由器
  - [ ] 定义数据处理路由
  - [ ] 定义案例管理路由
  - [ ] 定义文件管理路由
- [ ] 创建 `api/services.py` - 业务逻辑
  - [ ] 迁移现有业务逻辑
  - [ ] 实现案例管理服务
  - [ ] 实现文件管理服务
- [ ] 创建 `api/utils.py` - 工具函数
  - [ ] 迁移现有工具函数
  - [ ] 添加新的工具函数

#### **核心API端点实现（预估10个左右）**

##### **数据处理API**
- [ ] 实现 `POST /process_od_data/` 端点
- [ ] 实现 `POST /run_simulation/` 端点
- [ ] 实现 `POST /analyze_accuracy/` 端点

##### **案例管理API**
- [ ] 实现 `POST /create_case/` 端点
- [ ] 实现 `GET /list_cases/` 端点
- [ ] 实现 `GET /case/{case_id}` 端点
- [ ] 实现 `DELETE /case/{case_id}` 端点
- [ ] 实现 `POST /case/{case_id}/clone` 端点

##### **文件管理API**
- [ ] 实现 `GET /get_folders/{prefix}` 端点
- [ ] 实现 `GET /accuracy_analysis_status/{result_folder}` 端点

**注：** 以上API端点为预估数量，实际开发过程中可能会根据需求调整增加或减少。

#### **API功能实现**

- [ ] 实现案例目录创建逻辑
- [ ] 实现模板文件复制逻辑
- [ ] 实现元数据初始化逻辑
- [ ] 实现案例列表排序功能
- [ ] 实现案例搜索功能
- [ ] 实现案例备份功能
- [ ] 实现案例恢复功能

### **1.4 创建模板文件管理机制**

#### **模板管理功能**

- [ ] 实现模板文件格式验证
- [ ] 实现模板文件完整性检查
- [ ] 实现模板版本管理
- [ ] 实现模板依赖关系检查

### **1.5 建立共享资源管理框架**

#### **共享资源管理功能**

- [ ] 实现共享资源更新机制
- [ ] 实现共享资源版本控制
- [ ] 实现共享资源备份功能
- [ ] 实现共享资源同步功能
- [ ] 实现TAZ工具管理功能
  - [ ] 实现TAZ工具版本控制
  - [ ] 实现TAZ工具配置管理
  - [ ] 实现TAZ工具输出管理

---

## 🔄 **阶段2: 数据迁移和兼容性 (第3-4周)**

### **2.1 实现数据迁移工具**

#### **迁移工具开发**

- [ ] 开发现有数据扫描工具
- [ ] 开发数据转换工具
- [ ] 开发数据验证工具
- [ ] 开发迁移回滚工具

#### **迁移脚本编写**

- [ ] 编写 `run_*` 文件夹迁移脚本
- [ ] 编写 `accuracy_analysis` 文件夹迁移脚本
- [ ] 编写配置文件迁移脚本
- [ ] 编写元数据生成脚本
- [ ] 编写 `taz_analysis` 文件夹迁移脚本

### **2.2 保持现有API的兼容性**

#### **兼容性层实现**

- [ ] 实现现有API端点包装器
- [ ] 实现数据格式转换功能
- [ ] 实现路径映射功能
- [ ] 实现响应格式适配

#### **API路由更新**

- [ ] 更新现有API路由
- [ ] 添加API版本控制
- [ ] 实现API重定向功能
- [ ] 实现API废弃警告

### **2.3 创建案例转换功能**

#### **案例转换工具**

- [ ] 开发案例转换脚本
- [ ] 实现批量转换功能
- [ ] 实现转换进度跟踪
- [ ] 实现转换错误处理

#### **转换验证功能**

- [ ] 实现转换结果验证
- [ ] 实现数据完整性检查
- [ ] 实现转换日志记录
- [ ] 实现转换报告生成

### **2.4 实现新旧系统的并行运行**

#### **并行运行机制**

- [ ] 实现新旧API并行运行
- [ ] 实现数据同步机制
- [ ] 实现负载均衡功能
- [ ] 实现故障切换功能

#### **监控和日志**

- [ ] 实现并行运行监控
- [ ] 实现性能对比分析
- [ ] 实现错误日志记录
- [ ] 实现运行状态报告

### **2.5 测试数据迁移的准确性**

#### **迁移测试**

- [ ] 编写迁移测试用例
- [ ] 实现自动化测试脚本
- [ ] 执行数据完整性测试
- [ ] 执行功能回归测试

#### **测试报告**

- [ ] 生成迁移测试报告
- [ ] 分析迁移性能数据
- [ ] 识别迁移问题
- [ ] 提出优化建议

---

## ⚙️ **阶段3: 功能迁移和优化 (第5-6周)**

### **3.1 迁移OD数据处理功能**

#### **OD数据处理迁移**

- [ ] 迁移OD数据查询功能到 `api/services.py`
- [ ] 迁移OD数据过滤功能到 `api/services.py`
- [ ] 迁移OD数据转换功能到 `api/services.py`
- [ ] 迁移OD数据验证功能到 `api/services.py`
- [ ] 迁移TAZ数据处理功能到 `shared/utilities/taz_tools/`

#### **OD数据API更新**

- [ ] 更新OD数据处理API路由
- [ ] 实现新的OD数据格式
- [ ] 优化OD数据处理性能
- [ ] 添加OD数据处理日志

### **3.2 迁移仿真运行功能**

#### **仿真功能迁移**

- [ ] 迁移仿真配置生成功能到 `api/services.py`
- [ ] 迁移仿真执行功能到 `api/services.py`
- [ ] 迁移仿真结果收集功能到 `api/services.py`
- [ ] 迁移仿真状态监控功能到 `api/services.py`

#### **仿真API更新**

- [ ] 更新仿真运行API路由
- [ ] 实现新的仿真参数格式
- [ ] 优化仿真执行性能
- [ ] 添加仿真执行日志

### **3.3 迁移精度分析功能**

#### **精度分析迁移**

- [ ] 迁移精度分析算法到 `api/services.py`
- [ ] 迁移数据预处理功能到 `api/services.py`
- [ ] 迁移结果生成功能到 `api/services.py`
- [ ] 迁移报告生成功能到 `api/services.py`

#### **精度分析API更新**

- [ ] 更新精度分析API路由
- [ ] 实现新的分析参数格式
- [ ] 优化分析执行性能
- [ ] 添加分析执行日志

### **3.4 优化数据流向**

#### **数据流向优化**

- [ ] 优化文件读写路径
- [ ] 优化数据传输格式
- [ ] 优化数据存储结构
- [ ] 优化数据访问性能

#### **数据流监控**

- [ ] 实现数据流监控功能
- [ ] 实现数据流性能分析
- [ ] 实现数据流错误检测
- [ ] 实现数据流优化建议

### **3.5 实现新的前端界面**

#### **前端界面更新**

- [ ] 更新案例管理界面
- [ ] 更新仿真控制界面
- [ ] 更新分析结果界面
- [ ] 更新状态监控界面

#### **前端功能增强**

- [ ] 添加案例列表功能
- [ ] 添加案例详情查看
- [ ] 添加案例状态监控
- [ ] 添加文件管理功能

---

## 🧪 **阶段4: 测试和优化 (第7-8周)**

### **4.1 功能测试**

#### **API功能测试**

- [ ] 测试数据处理API（3个端点）
- [ ] 测试案例管理API（5个端点）
- [ ] 测试文件管理API（2个端点）
- [ ] 测试API错误处理
- [ ] 测试新增API端点（如有）
- [ ] 测试TAZ工具功能
  - [ ] 测试TAZ文件验证功能
  - [ ] 测试TAZ文件修复功能
  - [ ] 测试TAZ文件比较功能

#### **前端功能测试**

- [ ] 测试案例管理界面
- [ ] 测试仿真控制界面
- [ ] 测试分析结果界面
- [ ] 测试状态监控界面

#### **集成测试**

- [ ] 测试端到端流程
- [ ] 测试数据一致性
- [ ] 测试错误处理
- [ ] 测试边界条件

### **4.2 性能测试**

#### **API性能测试**

- [ ] 测试API响应时间
- [ ] 测试并发处理能力
- [ ] 测试内存使用情况
- [ ] 测试数据库连接池性能

#### **系统性能测试**

- [ ] 测试文件处理性能
- [ ] 测试仿真运行性能
- [ ] 测试分析计算性能
- [ ] 测试系统资源使用

### **4.3 文档完善**

#### **技术文档**

- [ ] 完善API文档
- [ ] 完善架构文档
- [ ] 完善部署文档
- [ ] 完善故障排除文档

#### **用户文档**

- [ ] 完善用户操作指南
- [ ] 完善案例管理手册
- [ ] 完善分析结果解读
- [ ] 完善常见问题解答

---

## 📊 **进度跟踪模板**

### **每日进度更新**

```
日期: _________
阶段: _________
完成任务:
- [ ] 任务1
- [ ] 任务2
- [ ] 任务3

遇到的问题:
- 问题1
- 问题2

明日计划:
- 计划1
- 计划2
```

### **每周进度总结**

```
周次: _________
阶段: _________
本周完成:
- 主要成果1
- 主要成果2
- 主要成果3

遇到的问题:
- 问题1及解决方案
- 问题2及解决方案

下周计划:
- 计划1
- 计划2
- 计划3

风险点:
- 风险1
- 风险2
```

---

**文档版本**: v1.1
**创建日期**: 2025-01-08
**最后更新**: 2025-01-08
**负责人**: 开发团队
**审核人**: 项目经理
