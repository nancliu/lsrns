# å·¥ç¨‹ç»“æ„ä¼˜åŒ–è®¾è®¡æ–¹æ¡ˆ

## ğŸ“‹ **é¡¹ç›®æ¦‚è¿°**

### **ç›®æ ‡**

ä¼˜åŒ–ODæ•°æ®å¤„ç†ä¸ä»¿çœŸç³»ç»Ÿçš„å·¥ç¨‹ç»“æ„ï¼Œè§£å†³å½“å‰å­˜åœ¨çš„æ–‡ä»¶å¤¹ç®¡ç†æ··ä¹±ã€æ•°æ®æµå‘ä¸æ¸…æ™°ã€æ‰©å±•æ€§å·®ç­‰é—®é¢˜ï¼Œå»ºç«‹æ¸…æ™°ã€å¯ç»´æŠ¤ã€æ˜“æ‰©å±•çš„å·¥ç¨‹æ¶æ„ã€‚

### **ç°çŠ¶åˆ†æ**

å½“å‰ç³»ç»Ÿå­˜åœ¨ä»¥ä¸‹ä¸»è¦é—®é¢˜ï¼š

1. **E1æ–‡ä»¶å¤¹è¦†ç›–é—®é¢˜**: ä»¿çœŸå®ŒæˆåE1æ•°æ®ä¼šè¢«è¦†ç›–ï¼Œéœ€è¦å¤åˆ¶åˆ°åˆ†æç›®å½•
2. **æ•°æ®åˆ†æ•£é—®é¢˜**: ä»¿çœŸç»“æœå’Œåˆ†æç»“æœåˆ†æ•£åœ¨ä¸åŒç›®å½•
3. **æ‰©å±•æ€§å·®**: æ·»åŠ æ–°åŠŸèƒ½éœ€è¦ä¿®æ”¹å¤šå¤„ä»£ç 
4. **æ•°æ®æµå‘ä¸æ¸…æ™°**: æ–‡ä»¶å¤¹ç»“æ„æ²¡æœ‰åæ˜ å¤„ç†é€»è¾‘

### **ä¼˜åŒ–è¿›å±•**

#### **å·²å®Œæˆé˜¶æ®µ**
- âœ… **é˜¶æ®µ1: åŸºç¡€æ¶æ„æ­å»º** (ç¬¬1-2å‘¨) - 100%å®Œæˆ
- âœ… **é˜¶æ®µ2: æ•°æ®è¿ç§»å’Œå…¼å®¹æ€§** (ç¬¬3-4å‘¨) - 100%å®Œæˆ

#### **å½“å‰çŠ¶æ€**
- ğŸš§ **é˜¶æ®µ3: åŠŸèƒ½è¿ç§»å’Œä¼˜åŒ–** (ç¬¬5-6å‘¨) - è¿›è¡Œä¸­
- â³ **é˜¶æ®µ4: æµ‹è¯•å’Œä¼˜åŒ–** (ç¬¬7-8å‘¨) - å¾…å¼€å§‹
- â³ **é˜¶æ®µ5: éƒ¨ç½²å’Œç›‘æ§** (ç¬¬9å‘¨) - å¾…å¼€å§‹

## ğŸ—ï¸ **ä¼˜åŒ–åçš„å·¥ç¨‹ç»“æ„**

### **å·²å®ç°çš„ç›®å½•ç»“æ„**

ç»è¿‡ç¬¬ä¸€é˜¶æ®µå’Œç¬¬äºŒé˜¶æ®µçš„å·¥ä½œï¼Œä»¥ä¸‹ç›®å½•ç»“æ„å·²ç»å®ç°ï¼š

```
ODç”Ÿæˆè„šæœ¬/
â”œâ”€â”€ cases/                           # æ¡ˆä¾‹æ ¹ç›®å½• âœ…
â”‚   â”œâ”€â”€ case_20250808_103528/        # è¿ç§»çš„ä»¿çœŸæ¡ˆä¾‹ âœ…
â”‚   â”‚   â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶ âœ…
â”‚   â”‚   â”‚   â”œâ”€â”€ od_data.xml         # ODæ•°æ® âœ…
â”‚   â”‚   â”‚   â”œâ”€â”€ simulation.sumocfg  # ä»¿çœŸé…ç½® âœ…
â”‚   â”‚   â”‚   â””â”€â”€ static.xml          # é™æ€æ–‡ä»¶ âœ…
â”‚   â”‚   â”œâ”€â”€ simulation/              # ä»¿çœŸç»“æœ âœ…
â”‚   â”‚   â”‚   â”œâ”€â”€ e1_detectors/       # E1æ£€æµ‹å™¨è¾“å‡º âœ…
â”‚   â”‚   â”‚   â”œâ”€â”€ gantry_data/        # é—¨æ¶æ•°æ® âœ…
â”‚   â”‚   â”‚   â””â”€â”€ summary.xml         # ä»¿çœŸæ‘˜è¦ âœ…
â”‚   â”‚   â”œâ”€â”€ analysis/                # åˆ†æç»“æœ âœ…
â”‚   â”‚   â”‚   â””â”€â”€ accuracy/           # ç²¾åº¦åˆ†æ âœ…
â”‚   â”‚   â””â”€â”€ metadata.json           # æ¡ˆä¾‹å…ƒæ•°æ® âœ…
â”‚   â””â”€â”€ case_20250808_101848/        # ç²¾åº¦åˆ†ææ¡ˆä¾‹ âœ…
â”‚       â””â”€â”€ analysis/accuracy/results/ # ç²¾åº¦åˆ†æç»“æœ âœ…
â”œâ”€â”€ templates/                       # æ¨¡æ¿æ–‡ä»¶ âœ…
â”‚   â”œâ”€â”€ taz_files/                  # TAZæ–‡ä»¶æ¨¡æ¿ âœ…
â”‚   â”‚   â”œâ”€â”€ TAZ_5_validated.add.xml
â”‚   â”‚   â”œâ”€â”€ TAZ_4.add.xml
â”‚   â”‚   â””â”€â”€ taz_templates.json      # TAZé…ç½®æ¨¡æ¿ âœ…
â”‚   â”œâ”€â”€ network_files/              # ç½‘ç»œæ–‡ä»¶æ¨¡æ¿ âœ…
â”‚   â”‚   â”œâ”€â”€ sichuan202503v6.net.xml
â”‚   â”‚   â”œâ”€â”€ sichuan202503v5.net.xml
â”‚   â”‚   â””â”€â”€ network_configs.json    # ç½‘ç»œé…ç½®æ¨¡æ¿ âœ…
â”‚   â””â”€â”€ config_templates/           # é…ç½®æ¨¡æ¿ âœ…
â”‚       â”œâ”€â”€ simulation_templates/    # ä»¿çœŸé…ç½®æ¨¡æ¿ âœ…
â”‚       â”‚   â”œâ”€â”€ default.sumocfg     # é»˜è®¤ä»¿çœŸé…ç½® âœ…
â”‚       â”‚   â”œâ”€â”€ mesoscopic.sumocfg  # ä¸­è§‚ä»¿çœŸé…ç½® âœ…
â”‚       â”‚   â””â”€â”€ microscopic.sumocfg # å¾®è§‚ä»¿çœŸé…ç½® âœ…
â”‚       â””â”€â”€ vehicle_templates/       # è½¦è¾†ç±»å‹æ¨¡æ¿ âœ…
â”‚           â””â”€â”€ vehicle_types.json  # è½¦è¾†ç±»å‹é…ç½® âœ…
â”œâ”€â”€ shared/                         # å…±äº«èµ„æº âœ…
â”‚   â””â”€â”€ utilities/                  # é€šç”¨å·¥å…· âœ…
â”‚       â””â”€â”€ taz_tools/              # TAZç›¸å…³å·¥å…· âœ…
â”‚           â”œâ”€â”€ analyze_duplicate_taz.py
â”‚           â”œâ”€â”€ compare_taz_files.py
â”‚           â”œâ”€â”€ fix_duplicate_taz.py
â”‚           â”œâ”€â”€ fix_taz.bat
â”‚           â”œâ”€â”€ taz_validator.py
â”‚           â”œâ”€â”€ README.md
â”‚           â””â”€â”€ output/              # è¾“å‡ºæ–‡ä»¶ç›®å½• âœ…
â”‚               â”œâ”€â”€ taz_to_simnetwork_updated.csv
â”‚               â”œâ”€â”€ taz_to_simnetwork_updated_oppo.csv
â”‚               â””â”€â”€ taz_validation_results.csv
â”œâ”€â”€ api/                            # APIæœåŠ¡ âœ…
â”‚   â”œâ”€â”€ main.py                     # FastAPIä¸»ç¨‹åºå…¥å£ âœ…
â”‚   â”œâ”€â”€ models.py                   # Pydanticæ•°æ®æ¨¡å‹ âœ…
â”‚   â”œâ”€â”€ routes.py                   # APIè·¯ç”±å®šä¹‰ âœ…
â”‚   â”œâ”€â”€ services.py                 # ä¸šåŠ¡é€»è¾‘æœåŠ¡ âœ…
â”‚   â”œâ”€â”€ utils.py                    # å·¥å…·å‡½æ•° âœ…
â”‚   â”œâ”€â”€ compatibility.py            # å…¼å®¹æ€§å±‚ âœ…
â”‚   â””â”€â”€ __init__.py                 # åŒ…åˆå§‹åŒ–æ–‡ä»¶ âœ…
â”œâ”€â”€ frontend/                       # å‰ç«¯ç•Œé¢ âœ…
â”‚   â”œâ”€â”€ index.html                  # ä¸»é¡µé¢ âœ…
â”‚   â”œâ”€â”€ styles.css                  # æ ·å¼æ–‡ä»¶ âœ…
â”‚   â”œâ”€â”€ script.js                   # JavaScripté€»è¾‘ âœ…
â”‚   â””â”€â”€ test_pages/                 # æµ‹è¯•é¡µé¢ âœ…
â”œâ”€â”€ docs/                           # æ–‡æ¡£ âœ…
â”‚   â”œâ”€â”€ README.md                   # é¡¹ç›®è¯´æ˜ âœ…
â”‚   â”œâ”€â”€ api_docs/                   # APIæ–‡æ¡£ âœ…
â”‚   â”‚   â””â”€â”€ README.md               # APIæ–‡æ¡£è¯´æ˜ âœ…
â”‚   â””â”€â”€ development/                # å¼€å‘æ–‡æ¡£ âœ…
â”‚       â””â”€â”€ phase2_summary.md       # ç¬¬äºŒé˜¶æ®µæ€»ç»“ âœ…
â”œâ”€â”€ shared/utilities/migration_tools.py # æ•°æ®è¿ç§»å·¥å…· âœ…
â”œâ”€â”€ test_migration.py               # è¿ç§»æµ‹è¯•è„šæœ¬ âœ…
â”œâ”€â”€ requirements.txt                 # é¡¹ç›®ä¾èµ– âœ…
â”œâ”€â”€ start_api.bat                   # APIå¯åŠ¨è„šæœ¬ âœ…
â””â”€â”€ test_api.py                     # APIæµ‹è¯•è„šæœ¬ âœ…
```

### **ç¬¬äºŒé˜¶æ®µæ–°å¢åŠŸèƒ½**

#### **æ•°æ®è¿ç§»å·¥å…·**
- âœ… **æ™ºèƒ½æ•°æ®æ‰«æ**: è‡ªåŠ¨è¯†åˆ«ç°æœ‰æ•°æ®ç»“æ„
- âœ… **æ¡ˆä¾‹è¿ç§»**: å°†runæ–‡ä»¶å¤¹è½¬æ¢ä¸ºæ¡ˆä¾‹ç»“æ„
- âœ… **ç²¾åº¦åˆ†æè¿ç§»**: å…³è”ç²¾åº¦åˆ†æç»“æœåˆ°æ¡ˆä¾‹
- âœ… **å…ƒæ•°æ®ç”Ÿæˆ**: è‡ªåŠ¨ç”Ÿæˆæ¡ˆä¾‹å…ƒæ•°æ®
- âœ… **è¿ç§»æŠ¥å‘Š**: ç”Ÿæˆè¯¦ç»†çš„è¿ç§»æŠ¥å‘Š

#### **å…¼å®¹æ€§å±‚**
- âœ… **å…¼å®¹æ€§API**: æä¾›ä¸åŸæœ‰APIæ ¼å¼å…¼å®¹çš„ç«¯ç‚¹
- âœ… **æ•°æ®è½¬æ¢**: åœ¨æ–°æ—§æ•°æ®æ ¼å¼ä¹‹é—´è½¬æ¢
- âœ… **è·¯å¾„æ˜ å°„**: å¤„ç†æ–°æ—§æ–‡ä»¶è·¯å¾„çš„æ˜ å°„
- âœ… **å¹¶è¡Œè¿è¡Œ**: æ”¯æŒæ–°æ—§ç³»ç»Ÿå¹¶è¡Œè¿è¡Œ

#### **æµ‹è¯•æ¡†æ¶**
- âœ… **å•å…ƒæµ‹è¯•**: æ¯ä¸ªè¿ç§»åŠŸèƒ½éƒ½æœ‰å¯¹åº”æµ‹è¯•
- âœ… **é›†æˆæµ‹è¯•**: å®Œæ•´çš„è¿ç§»æµç¨‹æµ‹è¯•
- âœ… **å…¼å®¹æ€§æµ‹è¯•**: éªŒè¯æ–°æ—§APIçš„å…¼å®¹æ€§
- âœ… **æ€§èƒ½æµ‹è¯•**: éªŒè¯è¿ç§»å·¥å…·çš„æ€§èƒ½

### **æ•´ä½“ç›®å½•ç»“æ„**

```
sim_scripts/
â”œâ”€â”€ cases/                           # æ¡ˆä¾‹æ ¹ç›®å½•
â”‚   â”œâ”€â”€ case_20250807_145645/        # å•ä¸ªæ¡ˆä¾‹ç›®å½•
â”‚   â”‚   â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶å¤¹
â”‚   â”‚   â”‚   â”œâ”€â”€ od_data.xml         # ODæ•°æ®
â”‚   â”‚   â”‚   â”œâ”€â”€ routes.xml          # è·¯ç”±æ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ simulation.sumocfg  # ä»¿çœŸé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ taz.add.xml         # TAZæ–‡ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ network.net.xml     # ç½‘ç»œæ–‡ä»¶
â”‚   â”‚   â”‚   â””â”€â”€ vehicle_types.json  # è½¦è¾†ç±»å‹é…ç½®
â”‚   â”‚   â”œâ”€â”€ simulation/              # ä»¿çœŸç»“æœ
â”‚   â”‚   â”‚   â”œâ”€â”€ e1_detectors/       # E1æ£€æµ‹å™¨è¾“å‡º
â”‚   â”‚   â”‚   â”œâ”€â”€ gantry_data/        # é—¨æ¶æ•°æ®
â”‚   â”‚   â”‚   â”œâ”€â”€ summary.xml         # ä»¿çœŸæ‘˜è¦
â”‚   â”‚   â”‚   â””â”€â”€ tripinfo.xml        # è¡Œç¨‹ä¿¡æ¯
â”‚   â”‚   â”œâ”€â”€ analysis/                # åˆ†æç»“æœ
â”‚   â”‚   â”‚   â”œâ”€â”€ accuracy/           # ç²¾åº¦åˆ†æ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ results/        # åˆ†æç»“æœ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ charts/         # å›¾è¡¨
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ reports/        # æŠ¥å‘Š
â”‚   â”‚   â”‚   â”œâ”€â”€ traffic_flow/       # äº¤é€šæµåˆ†æï¼ˆæœªæ¥æ‰©å±•ï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ performance/        # æ€§èƒ½åˆ†æï¼ˆæœªæ¥æ‰©å±•ï¼‰
â”‚   â”‚   â””â”€â”€ metadata.json           # æ¡ˆä¾‹å…ƒæ•°æ®
â”‚   â””â”€â”€ case_20250807_150000/       # å¦ä¸€ä¸ªæ¡ˆä¾‹
â”œâ”€â”€ templates/                       # æ¨¡æ¿æ–‡ä»¶
â”‚   â”œâ”€â”€ taz_files/                  # TAZæ–‡ä»¶æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ TAZ_5_validated.add.xml
â”‚   â”‚   â”œâ”€â”€ TAZ_4.add.xml
â”‚   â”‚   â””â”€â”€ taz_templates.json      # TAZé…ç½®æ¨¡æ¿
â”‚   â”œâ”€â”€ network_files/              # ç½‘ç»œæ–‡ä»¶æ¨¡æ¿
â”‚   â”‚   â”œâ”€â”€ sichuan202503v6.net.xml
â”‚   â”‚   â”œâ”€â”€ sichuan202503v5.net.xml
â”‚   â”‚   â””â”€â”€ network_configs.json    # ç½‘ç»œé…ç½®æ¨¡æ¿
â”‚   â””â”€â”€ config_templates/           # é…ç½®æ¨¡æ¿
â”‚       â”œâ”€â”€ simulation_templates/    # ä»¿çœŸé…ç½®æ¨¡æ¿
â”‚       â”‚   â”œâ”€â”€ default.sumocfg     # é»˜è®¤ä»¿çœŸé…ç½®
â”‚       â”‚   â”œâ”€â”€ mesoscopic.sumocfg  # ä¸­è§‚ä»¿çœŸé…ç½®
â”‚       â”‚   â””â”€â”€ microscopic.sumocfg # å¾®è§‚ä»¿çœŸé…ç½®
â”‚       â”œâ”€â”€ vehicle_templates/       # è½¦è¾†ç±»å‹æ¨¡æ¿
â”‚       â”‚   â”œâ”€â”€ vehicle_types.json  # è½¦è¾†ç±»å‹é…ç½®
â”‚       â”‚   â””â”€â”€ vehicle_profiles/   # è½¦è¾†é…ç½®æ–‡ä»¶
â”‚       â””â”€â”€ detector_templates/      # æ£€æµ‹å™¨æ¨¡æ¿
â”‚           â”œâ”€â”€ E1_detector.add.xml # E1æ£€æµ‹å™¨é…ç½®
â”‚           â””â”€â”€ gantry_locations.xml # é—¨æ¶ä½ç½®é…ç½®
â”œâ”€â”€ shared/                         # å…±äº«èµ„æº
â”‚   â”œâ”€â”€ e1_detectors/               # E1æ£€æµ‹å™¨é…ç½®
â”‚   â”‚   â”œâ”€â”€ detector_configs/       # æ£€æµ‹å™¨é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ calibration_data/       # æ ¡å‡†æ•°æ®
â”‚   â”‚   â””â”€â”€ validation_rules/       # éªŒè¯è§„åˆ™
â”‚   â”œâ”€â”€ gantry_locations/           # é—¨æ¶ä½ç½®
â”‚   â”‚   â”œâ”€â”€ gantry_coordinates.json # é—¨æ¶åæ ‡
â”‚   â”‚   â”œâ”€â”€ gantry_mapping.csv      # é—¨æ¶æ˜ å°„
â”‚   â”‚   â””â”€â”€ flow_corridors/         # æµé‡èµ°å»Š
â”‚   â”œâ”€â”€ analysis_tools/             # åˆ†æå·¥å…·
â”‚   â”‚   â”œâ”€â”€ accuracy_analysis/      # ç²¾åº¦åˆ†æå·¥å…·
â”‚   â”‚   â”œâ”€â”€ traffic_flow_analysis/  # äº¤é€šæµåˆ†æå·¥å…·
â”‚   â”‚   â””â”€â”€ performance_analysis/   # æ€§èƒ½åˆ†æå·¥å…·
â”‚   â”œâ”€â”€ data_processors/            # æ•°æ®å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ od_processor.py         # ODæ•°æ®å¤„ç†
â”‚   â”‚   â”œâ”€â”€ detector_processor.py   # æ£€æµ‹å™¨æ•°æ®å¤„ç†
â”‚   â”‚   â””â”€â”€ gantry_processor.py     # é—¨æ¶æ•°æ®å¤„ç†
â”‚   â””â”€â”€ utilities/                  # é€šç”¨å·¥å…·
â”‚       â”œâ”€â”€ file_utils.py           # æ–‡ä»¶æ“ä½œå·¥å…·
â”‚       â”œâ”€â”€ data_utils.py           # æ•°æ®å¤„ç†å·¥å…·
â”‚       â”œâ”€â”€ validation_utils.py     # éªŒè¯å·¥å…·
â”‚       â””â”€â”€ taz_tools/              # TAZç›¸å…³å·¥å…·
â”‚           â”œâ”€â”€ analyze_duplicate_taz.py
â”‚           â”œâ”€â”€ compare_taz_files.py
â”‚           â”œâ”€â”€ fix_duplicate_taz.py
â”‚           â”œâ”€â”€ fix_taz.bat
â”‚           â”œâ”€â”€ taz_validator.py
â”‚           â”œâ”€â”€ README.md
â”‚           â””â”€â”€ output/              # è¾“å‡ºæ–‡ä»¶ç›®å½•
â”‚               â”œâ”€â”€ taz_to_simnetwork_updated.csv
â”‚               â”œâ”€â”€ taz_to_simnetwork_updated_oppo.csv
â”‚               â””â”€â”€ taz_validation_results.csv
â”œâ”€â”€ api/                            # APIæœåŠ¡ï¼ˆç®€åŒ–ç»“æ„ï¼‰
â”‚   â”œâ”€â”€ main.py                     # FastAPIä¸»ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ models.py                   # Pydanticæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ routes.py                   # APIè·¯ç”±å®šä¹‰
â”‚   â”œâ”€â”€ services.py                 # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”‚   â”œâ”€â”€ utils.py                    # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ compatibility.py            # å…¼å®¹æ€§å±‚
â”‚   â””â”€â”€ __init__.py                 # åŒ…åˆå§‹åŒ–æ–‡ä»¶
â”‚   â”œâ”€â”€ models.py                   # æ‰€æœ‰Pydanticæ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ routes.py                   # æ‰€æœ‰APIè·¯ç”±
â”‚   â”œâ”€â”€ services.py                 # ä¸šåŠ¡é€»è¾‘
â”‚   â””â”€â”€ utils.py                    # å·¥å…·å‡½æ•°
â”œâ”€â”€ frontend/                       # å‰ç«¯ç•Œé¢
â”‚   â”œâ”€â”€ index.html                  # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ script.js                   # å‰ç«¯é€»è¾‘
â”‚   â”œâ”€â”€ styles.css                  # æ ·å¼æ–‡ä»¶
â”‚   â””â”€â”€ test_pages/                 # æµ‹è¯•é¡µé¢
â””â”€â”€ docs/                           # æ–‡æ¡£
    â”œâ”€â”€ api_docs/                   # APIæ–‡æ¡£
    â”œâ”€â”€ user_guide/                 # ç”¨æˆ·æŒ‡å—
    â””â”€â”€ development/                # å¼€å‘æ–‡æ¡£
```

## ğŸ”„ **æ•°æ®æµå‘è®¾è®¡**

### **æ­¥éª¤1: åˆ›å»ºæ¡ˆä¾‹**

```python
@app.post("/create_case/")
async def create_case(request: CaseCreationRequest):
    """
    åˆ›å»ºæ–°æ¡ˆä¾‹
    è¾“å…¥: æ—¶é—´èŒƒå›´ã€é…ç½®å‚æ•°
    è¾“å‡º: case_id
    ç”Ÿæˆ: case_YYYYMMDD_HHMMSS/ç›®å½•ç»“æ„
    """
```

### **æ­¥éª¤2: è¿è¡Œä»¿çœŸ**

```python
@app.post("/run_simulation/{case_id}")
async def run_simulation(case_id: str, request: SimulationRequest):
    """
    è¿è¡Œä»¿çœŸ
    è¾“å…¥: case_id, ä»¿çœŸå‚æ•°
    è¾“å‡º: ä»¿çœŸç»“æœ
    ç”Ÿæˆ: case_id/simulation/ä¸‹çš„æ‰€æœ‰ç»“æœæ–‡ä»¶
    """
```

### **æ­¥éª¤3: ç²¾åº¦åˆ†æ**

```python
@app.post("/analyze_accuracy/{case_id}")
async def analyze_accuracy(case_id: str, request: AccuracyAnalysisRequest):
    """
    ç²¾åº¦åˆ†æ
    è¾“å…¥: case_id, åˆ†æå‚æ•°
    è¾“å‡º: åˆ†æç»“æœ
    ç”Ÿæˆ: case_id/analysis/accuracy/ä¸‹çš„ç»“æœ
    """
```

### **æ­¥éª¤4: çŠ¶æ€æŸ¥è¯¢**

```python
@app.get("/case_status/{case_id}")
async def get_case_status(case_id: str):
    """
    æŸ¥è¯¢æ¡ˆä¾‹çŠ¶æ€
    è¾“å…¥: case_id
    è¾“å‡º: æ¡ˆä¾‹å®Œæ•´çŠ¶æ€ä¿¡æ¯
    """
```

## ğŸ“Š **å…ƒæ•°æ®ç®¡ç†**

### **æ¡ˆä¾‹å…ƒæ•°æ® (metadata.json)**

```json
{
  "case_id": "case_20250807_145645",
  "created_at": "2025-08-07T14:56:45",
  "updated_at": "2025-08-07T15:30:00",
  "time_range": {
    "start": "2025/07/21 08:00:00",
    "end": "2025/07/21 09:00:00"
  },
  "config": {
    "taz_file": "TAZ_5_validated.add.xml",
    "net_file": "sichuan202503v6.net.xml",
    "interval_minutes": 5,
    "enable_mesoscopic": false
  },
  "status": {
    "od_processed": true,
    "simulation_completed": true,
    "analysis_completed": false,
    "last_step": "simulation"
  },
  "files": {
    "od_file": "config/od_data.xml",
    "routes_file": "config/routes.xml",
    "config_file": "config/simulation.sumocfg",
    "taz_file": "config/taz.add.xml",
    "network_file": "config/network.net.xml"
  },
  "statistics": {
    "total_vehicles": 1250,
    "simulation_duration": 3600,
    "detector_count": 45,
    "gantry_count": 12
  }
}
```

## ğŸ› ï¸ **APIæ¥å£è®¾è®¡ï¼ˆç®€åŒ–ç»“æ„ï¼‰**

### **æ ¸å¿ƒAPIç«¯ç‚¹ï¼ˆé¢„ä¼°10ä¸ªå·¦å³ï¼‰**

#### **æ•°æ®å¤„ç†API**
```python
@app.post("/process_od_data/")                    # ODæ•°æ®å¤„ç†
@app.post("/run_simulation/")                     # è¿è¡Œä»¿çœŸ
@app.post("/analyze_accuracy/")                   # ç²¾åº¦åˆ†æ
```

#### **æ¡ˆä¾‹ç®¡ç†API**
```python
@app.post("/create_case/")                        # åˆ›å»ºæ¡ˆä¾‹
@app.get("/list_cases/")                          # åˆ—å‡ºæ‰€æœ‰æ¡ˆä¾‹
@app.get("/case/{case_id}")                       # è·å–æ¡ˆä¾‹è¯¦æƒ…
@app.delete("/case/{case_id}")                    # åˆ é™¤æ¡ˆä¾‹
@app.post("/case/{case_id}/clone")                # å…‹éš†æ¡ˆä¾‹
```

#### **æ–‡ä»¶ç®¡ç†API**
```python
@app.get("/get_folders/{prefix}")                 # è·å–æ–‡ä»¶å¤¹åˆ—è¡¨
@app.get("/accuracy_analysis_status/{result_folder}") # è·å–åˆ†æçŠ¶æ€
```

**æ³¨ï¼š** ä»¥ä¸ŠAPIç«¯ç‚¹ä¸ºé¢„ä¼°æ•°é‡ï¼Œå®é™…å¼€å‘è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæ ¹æ®éœ€æ±‚è°ƒæ•´å¢åŠ æˆ–å‡å°‘ã€‚

### **APIæ–‡ä»¶ç»“æ„**

#### **`api/main.py`** - ä¸»ç¨‹åºå…¥å£
```python
from fastapi import FastAPI
from fastapi.middleware.cors import CORSMiddleware
from api.routes import router

app = FastAPI(title="ODæ•°æ®å¤„ç†ä¸ä»¿çœŸç³»ç»Ÿ")
app.add_middleware(CORSMiddleware, allow_origins=["*"])
app.include_router(router, prefix="/api/v1")
```

#### **`api/models.py`** - æ•°æ®æ¨¡å‹
```python
from pydantic import BaseModel
from typing import Optional, List

class TimeRangeRequest(BaseModel):
    start_time: str
    end_time: str
    schemas_name: Optional[str] = "dwd"
    # ... å…¶ä»–å­—æ®µ

class SimulationRequest(BaseModel):
    run_folder: str
    # ... å…¶ä»–å­—æ®µ

class CaseCreationRequest(BaseModel):
    time_range: dict
    config: dict
    # ... å…¶ä»–å­—æ®µ

# ... å…¶ä»–æ¨¡å‹
```

#### **`api/routes.py`** - APIè·¯ç”±
```python
from fastapi import APIRouter, Depends
from api.models import *
from api.services import *

router = APIRouter()

# æ•°æ®å¤„ç†è·¯ç”±
@router.post("/process_od_data/")
async def process_od_data(request: TimeRangeRequest):
    return await process_od_data_service(request)

@router.post("/run_simulation/")
async def run_simulation(request: SimulationRequest):
    return await run_simulation_service(request)

@router.post("/analyze_accuracy/")
async def analyze_accuracy(request: AccuracyAnalysisRequest):
    return await analyze_accuracy_service(request)

# æ¡ˆä¾‹ç®¡ç†è·¯ç”±
@router.post("/create_case/")
async def create_case(request: CaseCreationRequest):
    return await create_case_service(request)

@router.get("/list_cases/")
async def list_cases():
    return await list_cases_service()

@router.get("/case/{case_id}")
async def get_case(case_id: str):
    return await get_case_service(case_id)

@router.delete("/case/{case_id}")
async def delete_case(case_id: str):
    return await delete_case_service(case_id)

@router.post("/case/{case_id}/clone")
async def clone_case(case_id: str):
    return await clone_case_service(case_id)

# æ–‡ä»¶ç®¡ç†è·¯ç”±
@router.get("/get_folders/{prefix}")
async def get_folders(prefix: str):
    return await get_folders_service(prefix)

@router.get("/accuracy_analysis_status/{result_folder}")
async def get_accuracy_analysis_status(result_folder: str):
    return await get_accuracy_analysis_status_service(result_folder)
```

#### **`api/services.py`** - ä¸šåŠ¡é€»è¾‘
```python
# ä»DLLtest2025_6_3.pyè¿ç§»çš„æ ¸å¿ƒä¸šåŠ¡é€»è¾‘
async def process_od_data_service(request: TimeRangeRequest):
    # åŸæœ‰çš„process_od_dataé€»è¾‘
    pass

async def run_simulation_service(request: SimulationRequest):
    # åŸæœ‰çš„run_simulationé€»è¾‘
    pass

async def analyze_accuracy_service(request: AccuracyAnalysisRequest):
    # åŸæœ‰çš„analyze_accuracyé€»è¾‘
    pass

# æ–°å¢çš„æ¡ˆä¾‹ç®¡ç†æœåŠ¡
async def create_case_service(request: CaseCreationRequest):
    # åˆ›å»ºæ¡ˆä¾‹é€»è¾‘
    pass

async def list_cases_service():
    # åˆ—å‡ºæ¡ˆä¾‹é€»è¾‘
    pass

async def get_case_service(case_id: str):
    # è·å–æ¡ˆä¾‹è¯¦æƒ…é€»è¾‘
    pass

async def delete_case_service(case_id: str):
    # åˆ é™¤æ¡ˆä¾‹é€»è¾‘
    pass

async def clone_case_service(case_id: str):
    # å…‹éš†æ¡ˆä¾‹é€»è¾‘
    pass

# æ–‡ä»¶ç®¡ç†æœåŠ¡
async def get_folders_service(prefix: str):
    # è·å–æ–‡ä»¶å¤¹åˆ—è¡¨é€»è¾‘
    pass

async def get_accuracy_analysis_status_service(result_folder: str):
    # è·å–åˆ†æçŠ¶æ€é€»è¾‘
    pass
```

#### **`api/utils.py`** - å·¥å…·å‡½æ•°
```python
# ä»DLLtest2025_6_3.pyè¿ç§»çš„å·¥å…·å‡½æ•°
def calculate_duration(start_time, end_time):
    # åŸæœ‰é€»è¾‘
    pass

def split_time_range(start_time, end_time, interval_minutes):
    # åŸæœ‰é€»è¾‘
    pass

def load_taz_ids(taz_file):
    # åŸæœ‰é€»è¾‘
    pass

def generate_od_xml(od_matrix, start_time, end_time, od_file):
    # åŸæœ‰é€»è¾‘
    pass

def generate_sumocfg(route_file, net_file, start_time, end_time, **kwargs):
    # åŸæœ‰é€»è¾‘
    pass

def run_sumo(sumocfg_file, gui=True):
    # åŸæœ‰é€»è¾‘
    pass

# ... å…¶ä»–å·¥å…·å‡½æ•°
```

## ğŸ“ˆ **å®æ–½è®¡åˆ’**

### **é˜¶æ®µ1: åŸºç¡€æ¶æ„æ­å»º (ç¬¬1-2å‘¨)**

#### **ç›®æ ‡**

å»ºç«‹æ–°çš„ç›®å½•ç»“æ„å’ŒåŸºç¡€APIæ¡†æ¶

#### **ä»»åŠ¡æ¸…å•**

- [ ] åˆ›å»ºæ–°çš„ç›®å½•ç»“æ„
- [ ] è®¾è®¡å¹¶å®ç°æ¡ˆä¾‹å…ƒæ•°æ®æ¨¡å‹
- [ ] å®ç°åŸºç¡€çš„æ¡ˆä¾‹ç®¡ç†API
- [ ] åˆ›å»ºæ¨¡æ¿æ–‡ä»¶ç®¡ç†æœºåˆ¶
- [ ] å»ºç«‹å…±äº«èµ„æºç®¡ç†æ¡†æ¶

#### **äº¤ä»˜ç‰©**

- æ–°çš„ç›®å½•ç»“æ„
- æ¡ˆä¾‹ç®¡ç†API (create_case, list_cases, get_case)
- æ¨¡æ¿æ–‡ä»¶ç®¡ç†åŠŸèƒ½
- å…±äº«èµ„æºç®¡ç†åŠŸèƒ½

### **é˜¶æ®µ2: æ•°æ®è¿ç§»å’Œå…¼å®¹æ€§ (ç¬¬3-4å‘¨)**

#### **ç›®æ ‡**

ä¿æŒå‘åå…¼å®¹ï¼Œå®ç°æ•°æ®è¿ç§»

#### **ä»»åŠ¡æ¸…å•**

- [ ] å®ç°æ•°æ®è¿ç§»å·¥å…·
- [ ] ä¿æŒç°æœ‰APIçš„å…¼å®¹æ€§
- [ ] åˆ›å»ºæ¡ˆä¾‹è½¬æ¢åŠŸèƒ½
- [ ] å®ç°æ–°æ—§ç³»ç»Ÿçš„å¹¶è¡Œè¿è¡Œ
- [ ] æµ‹è¯•æ•°æ®è¿ç§»çš„å‡†ç¡®æ€§

#### **äº¤ä»˜ç‰©**

- æ•°æ®è¿ç§»å·¥å…·
- å…¼å®¹æ€§å±‚
- æ¡ˆä¾‹è½¬æ¢åŠŸèƒ½
- è¿ç§»æµ‹è¯•æŠ¥å‘Š

### **é˜¶æ®µ3: åŠŸèƒ½è¿ç§»å’Œä¼˜åŒ– (ç¬¬5-6å‘¨)**

#### **ç›®æ ‡**

å°†ç°æœ‰åŠŸèƒ½è¿ç§»åˆ°æ–°æ¶æ„

#### **ä»»åŠ¡æ¸…å•**

- [ ] è¿ç§»ODæ•°æ®å¤„ç†åŠŸèƒ½
- [ ] è¿ç§»ä»¿çœŸè¿è¡ŒåŠŸèƒ½
- [ ] è¿ç§»ç²¾åº¦åˆ†æåŠŸèƒ½
- [ ] ä¼˜åŒ–æ•°æ®æµå‘
- [ ] å®ç°æ–°çš„å‰ç«¯ç•Œé¢

#### **äº¤ä»˜ç‰©**

- è¿ç§»åçš„ODæ•°æ®å¤„ç†åŠŸèƒ½
- æ–°çš„ä»¿çœŸè¿è¡Œæœºåˆ¶
- ä¼˜åŒ–çš„ç²¾åº¦åˆ†æåŠŸèƒ½
- æ›´æ–°çš„å‰ç«¯ç•Œé¢

### **é˜¶æ®µ4: æµ‹è¯•å’Œä¼˜åŒ– (ç¬¬7-8å‘¨)**

#### **ç›®æ ‡**

å…¨é¢æµ‹è¯•å’Œæ€§èƒ½ä¼˜åŒ–

#### **ä»»åŠ¡æ¸…å•**

- [ ] åŠŸèƒ½æµ‹è¯•
- [ ] æ€§èƒ½æµ‹è¯•
- [ ] å‹åŠ›æµ‹è¯•
- [ ] ç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] æ–‡æ¡£å®Œå–„

#### **äº¤ä»˜ç‰©**

- æµ‹è¯•æŠ¥å‘Š
- æ€§èƒ½ä¼˜åŒ–æŠ¥å‘Š
- ç”¨æˆ·æŒ‡å—
- å¼€å‘æ–‡æ¡£

## ğŸ¯ **ä¼˜åŒ–æ•ˆæœé¢„æœŸ**

### **è§£å†³çš„é—®é¢˜**

1. âœ… **E1æ–‡ä»¶å¤¹è¦†ç›–é—®é¢˜**: æ•°æ®ç›´æ¥ä¿å­˜åœ¨caseç›®å½•ä¸‹ï¼Œä¸ä¼šè¢«è¦†ç›–
2. âœ… **æ•°æ®åˆ†æ•£é—®é¢˜**: æ‰€æœ‰ç›¸å…³æ•°æ®åœ¨åŒä¸€æ¡ˆä¾‹ç›®å½•ä¸‹
3. âœ… **æ‰©å±•æ€§**: å¯ä»¥è½»æ¾æ·»åŠ æ–°çš„åˆ†æç±»å‹
4. âœ… **æ•°æ®æµå‘æ¸…æ™°**: æ–‡ä»¶å¤¹ç»“æ„åæ˜ å¤„ç†æµç¨‹

### **æ–°å¢ä¼˜åŠ¿**

1. **ç‰ˆæœ¬æ§åˆ¶å‹å¥½**: æ¯ä¸ªæ¡ˆä¾‹æ˜¯ç‹¬ç«‹çš„å•å…ƒ
2. **æ˜“äºå¤‡ä»½**: æ¡ˆä¾‹çº§åˆ«çš„å¤‡ä»½å’Œæ¢å¤
3. **å¹¶è¡Œå¤„ç†**: æ”¯æŒå¤šä¸ªæ¡ˆä¾‹åŒæ—¶å¤„ç†
4. **èµ„æºå¤ç”¨**: æ¨¡æ¿å’Œå…±äº«èµ„æºçš„é«˜æ•ˆåˆ©ç”¨
5. **ç›‘æ§å®Œå–„**: å®Œæ•´çš„æ¡ˆä¾‹ç”Ÿå‘½å‘¨æœŸç›‘æ§

## ğŸ“‹ **é£é™©è¯„ä¼°å’Œåº”å¯¹**

### **ä¸»è¦é£é™©**

1. **æ•°æ®è¿ç§»é£é™©**: ç°æœ‰æ•°æ®å¯èƒ½ä¸¢å¤±
2. **å…¼å®¹æ€§é£é™©**: ç°æœ‰APIå¯èƒ½å—å½±å“
3. **æ€§èƒ½é£é™©**: æ–°æ¶æ„å¯èƒ½å½±å“æ€§èƒ½
4. **ç”¨æˆ·é€‚åº”é£é™©**: ç”¨æˆ·éœ€è¦é€‚åº”æ–°ç•Œé¢

### **åº”å¯¹ç­–ç•¥**

1. **æ•°æ®å¤‡ä»½**: è¿ç§»å‰å®Œæ•´å¤‡ä»½
2. **æ¸è¿›è¿ç§»**: åˆ†é˜¶æ®µè¿ç§»ï¼Œä¿æŒå…¼å®¹æ€§
3. **æ€§èƒ½æµ‹è¯•**: æ¯ä¸ªé˜¶æ®µè¿›è¡Œæ€§èƒ½æµ‹è¯•
4. **ç”¨æˆ·åŸ¹è®­**: æä¾›è¯¦ç»†çš„ç”¨æˆ·æŒ‡å—å’ŒåŸ¹è®­

## ğŸ“š **æ–‡æ¡£å’ŒåŸ¹è®­**

### **æŠ€æœ¯æ–‡æ¡£**

- APIæ–‡æ¡£
- æ¶æ„è®¾è®¡æ–‡æ¡£
- éƒ¨ç½²æŒ‡å—
- æ•…éšœæ’é™¤æŒ‡å—

### **ç”¨æˆ·æ–‡æ¡£**

- ç”¨æˆ·æ“ä½œæŒ‡å—
- æ¡ˆä¾‹ç®¡ç†æ‰‹å†Œ
- åˆ†æç»“æœè§£è¯»æŒ‡å—
- å¸¸è§é—®é¢˜è§£ç­”

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1
**åˆ›å»ºæ—¥æœŸ**: 2025-01-08
**æœ€åæ›´æ–°**: 2025-01-08
**è´Ÿè´£äºº**: å¼€å‘å›¢é˜Ÿ
**å®¡æ ¸äºº**: é¡¹ç›®ç»ç†
