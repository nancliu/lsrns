# ODæ•°æ®å¤„ç†ä¸ä»¿çœŸç³»ç»Ÿï¼ˆv1.0ï¼‰

## é¡¹ç›®æ¦‚è¿°

ODæ•°æ®å¤„ç†ä¸ä»¿çœŸç³»ç»Ÿæ˜¯ä¸€ä¸ªåŸºäºæ¡ˆä¾‹ç®¡ç†çš„äº¤é€šä»¿çœŸåˆ†æå¹³å°ï¼Œé‡‡ç”¨ç°ä»£åŒ–æ¨¡å—åŒ–æ¶æ„è®¾è®¡ã€‚ç³»ç»Ÿå·²å®Œæˆä»ä¼ ç»Ÿå•ä½“æ¶æ„å‘å®Œå…¨æ¨¡å—åŒ–æ¶æ„çš„é‡æ„ï¼Œå…·æœ‰é«˜å¯ç»´æŠ¤æ€§ã€å¯æ‰©å±•æ€§å’Œä¼˜ç§€çš„å¼€å‘ä½“éªŒã€‚

### ğŸ¯ æ¶æ„ç‰¹ç‚¹

- **å®Œå…¨æ¨¡å—åŒ–è®¾è®¡**: APIå±‚ä¸“æ³¨æ¥å£ï¼ŒSharedå±‚ä¸“æ³¨æ ¸å¿ƒåŠŸèƒ½
- **æ¸…æ™°çš„èŒè´£åˆ†ç¦»**: æ¯ä¸ªæ¨¡å—èŒè´£å•ä¸€ï¼Œæ˜“äºç»´æŠ¤å’Œæµ‹è¯•
- **é«˜æ€§èƒ½**: æ¨¡å—å¯¼å…¥å’ŒæœåŠ¡å®ä¾‹åŒ–æ€§èƒ½ä¼˜ç§€
- **ç°ä»£åŒ–æŠ€æœ¯æ ˆ**: FastAPI + Pydantic + Python 3.10+

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.10+
- Windows 10/11

### å®‰è£…æ­¥éª¤

1. **å…‹éš†é¡¹ç›®**

   ```bash
   git clone [é¡¹ç›®åœ°å€]
   cd ODç”Ÿæˆè„šæœ¬
   ```

2. **å®‰è£…ä¾èµ–**ï¼ˆå…ˆ mambaï¼Œå pip è¡¥å……ï¼›å‹¿åœ¨ base ç¯å¢ƒå®‰è£…ï¼‰

   ```powershell
   mamba install -y -c conda-forge --file requirements.txt
   pip install -r requirements.txt
   ```

3. **å¯åŠ¨APIæœåŠ¡**

   ```powershell
   # æ–¹æ³•1: ä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
   .\start_api.bat

   # æ–¹æ³•2: ç›´æ¥è¿è¡Œï¼ˆéœ€å·²å®‰è£…ä¾èµ–ï¼‰
   python api\main.py
   ```

4. **è®¿é—®ç³»ç»Ÿ**

   - APIæœåŠ¡: http://localhost:8000
   - APIæ–‡æ¡£: http://localhost:8000/docs
   - å‰ç«¯ä¸»é¡µ: http://localhost:8000/index.html

## ç³»ç»ŸåŠŸèƒ½

### æ ¸å¿ƒåŠŸèƒ½

1. **æ¡ˆä¾‹ç®¡ç†**
   - åˆ›å»ºæ–°æ¡ˆä¾‹
   - æŸ¥çœ‹æ¡ˆä¾‹åˆ—è¡¨
   - æ¡ˆä¾‹è¯¦æƒ…æŸ¥çœ‹
   - æ¡ˆä¾‹å…‹éš†å’Œåˆ é™¤

2. **ä»¿çœŸæ§åˆ¶**
   - è¿è¡Œäº¤é€šä»¿çœŸ
   - ä»¿çœŸçŠ¶æ€ç›‘æ§
   - ä»¿çœŸç»“æœæŸ¥çœ‹

3. **ç²¾åº¦åˆ†æ**
   - ç²¾åº¦åˆ†ææ‰§è¡Œ
   - åˆ†æç»“æœæŸ¥çœ‹
   - æŠ¥å‘Šç”Ÿæˆ

4. **æ¨¡æ¿ç®¡ç†**
   - TAZæ–‡ä»¶æ¨¡æ¿
   - ç½‘ç»œæ–‡ä»¶æ¨¡æ¿
   - ä»¿çœŸé…ç½®æ¨¡æ¿

### APIæ¥å£ï¼ˆæŒ‰ä¸šåŠ¡åˆ†ç»„ï¼‰

- **æ•°æ®å¤„ç†**: `POST /api/v1/data/process_od_data/`
- **æ¡ˆä¾‹ç®¡ç†**: `GET /api/v1/case/list_cases/`, `POST /api/v1/case/create_case/`
- **ä»¿çœŸç®¡ç†**: `POST /api/v1/simulation/run_simulation/`
- **ç»“æœåˆ†æ**: `POST /api/v1/analysis/analyze_accuracy/`
- **æ¨¡æ¿ç®¡ç†**: `GET /api/v1/template/list_templates/`
- **æ–‡ä»¶ç®¡ç†**: `GET /api/v1/file/file_info/{file_path}`

## é¡¹ç›®ç»“æ„

```
ODç”Ÿæˆè„šæœ¬/
â”œâ”€â”€ api/                      # APIæ¥å£å±‚
â”‚   â”œâ”€â”€ main.py              # FastAPIä¸»ç¨‹åºï¼ˆå”¯ä¸€å…¥å£ï¼‰
â”‚   â”œâ”€â”€ services/            # ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”œâ”€â”€ base_service.py     # åŸºç¡€æœåŠ¡ç±»
â”‚   â”‚   â”œâ”€â”€ data_service.py     # æ•°æ®å¤„ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ case_service.py     # æ¡ˆä¾‹ç®¡ç†æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ simulation_service.py # ä»¿çœŸæœåŠ¡
â”‚   â”‚   â”œâ”€â”€ analysis_service.py   # åˆ†ææœåŠ¡
â”‚   â”‚   â”œâ”€â”€ template_service.py   # æ¨¡æ¿æœåŠ¡
â”‚   â”‚   â””â”€â”€ file_service.py       # æ–‡ä»¶æœåŠ¡
â”‚   â”œâ”€â”€ models/              # æ•°æ®æ¨¡å‹å±‚
â”‚   â”‚   â”œâ”€â”€ requests/           # è¯·æ±‚æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ responses/          # å“åº”æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ entities/           # å®ä½“æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ base.py            # åŸºç¡€æ¨¡å‹
â”‚   â”‚   â””â”€â”€ enums.py           # æšä¸¾å®šä¹‰
â”‚   â””â”€â”€ routes/              # APIè·¯ç”±å±‚
â”‚       â”œâ”€â”€ data_routes.py      # æ•°æ®å¤„ç†è·¯ç”±
â”‚       â”œâ”€â”€ case_routes.py      # æ¡ˆä¾‹ç®¡ç†è·¯ç”±
â”‚       â”œâ”€â”€ simulation_routes.py # ä»¿çœŸè·¯ç”±
â”‚       â”œâ”€â”€ analysis_routes.py   # åˆ†æè·¯ç”±
â”‚       â”œâ”€â”€ template_routes.py   # æ¨¡æ¿è·¯ç”±
â”‚       â”œâ”€â”€ file_routes.py       # æ–‡ä»¶è·¯ç”±
â”‚       â””â”€â”€ middleware.py        # ä¸­é—´ä»¶
â”œâ”€â”€ shared/                   # å…±äº«æ ¸å¿ƒåŠŸèƒ½å±‚
â”‚   â”œâ”€â”€ utilities/           # é€šç”¨å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ file_utils.py       # æ–‡ä»¶æ“ä½œå·¥å…·
â”‚   â”‚   â”œâ”€â”€ time_utils.py       # æ—¶é—´å¤„ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ sumo_utils.py       # SUMOä»¿çœŸå·¥å…·
â”‚   â”‚   â”œâ”€â”€ validation_utils.py # éªŒè¯å·¥å…·
â”‚   â”‚   â””â”€â”€ taz_utils.py        # TAZå¤„ç†å·¥å…·
â”‚   â”œâ”€â”€ data_access/         # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ connection.py       # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ db_config.py        # æ•°æ®åº“é…ç½®
â”‚   â”‚   â”œâ”€â”€ gantry_loader.py    # é—¨æ¶æ•°æ®åŠ è½½
â”‚   â”‚   â””â”€â”€ od_table_resolver.py # ODè¡¨è§£æå™¨
â”‚   â”œâ”€â”€ analysis_tools/      # åˆ†æå·¥å…·
â”‚   â”‚   â””â”€â”€ accuracy_analyzer.py # ç²¾åº¦åˆ†æå™¨
â”‚   â””â”€â”€ data_processors/     # æ•°æ®å¤„ç†å™¨
â”‚       â”œâ”€â”€ od_processor.py     # ODæ•°æ®å¤„ç†å™¨
â”‚       â””â”€â”€ simulation_processor.py # ä»¿çœŸæ•°æ®å¤„ç†å™¨
â”œâ”€â”€ cases/                    # æ¡ˆä¾‹æ ¹ç›®å½•
â”œâ”€â”€ templates/                # æ¨¡æ¿æ–‡ä»¶
â”‚   â”œâ”€â”€ taz_files/           # TAZæ–‡ä»¶æ¨¡æ¿
â”‚   â”œâ”€â”€ network_files/       # ç½‘ç»œæ–‡ä»¶æ¨¡æ¿
â”‚   â””â”€â”€ config_templates/    # é…ç½®æ¨¡æ¿
â”œâ”€â”€ frontend/                # å‰ç«¯æ–‡ä»¶
â”‚   â”œâ”€â”€ index.html          # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ script.js           # å‰ç«¯é€»è¾‘
â”‚   â””â”€â”€ styles.css          # æ ·å¼æ–‡ä»¶
â”œâ”€â”€ docs/                    # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ development/         # å¼€å‘ç›¸å…³æ–‡æ¡£
â”‚   â””â”€â”€ api_docs/           # APIæ–‡æ¡£
â”œâ”€â”€ sim_scripts/            # ä»¿çœŸè„šæœ¬ï¼ˆé—ç•™ï¼‰
â”œâ”€â”€ requirements.txt        # Pythonä¾èµ–
â””â”€â”€ start_api.bat          # å¯åŠ¨è„šæœ¬
```

## ä½¿ç”¨ç¤ºä¾‹

### åˆ›å»ºæ¡ˆä¾‹

```bash
curl -X POST "http://localhost:8000/api/v1/case/create_case/" \
  -H "Content-Type: application/json" \
  -d '{
    "case_name": "æµ‹è¯•æ¡ˆä¾‹",
    "description": "è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹"
  }'
```

### å¤„ç†ODæ•°æ®

```bash
curl -X POST "http://localhost:8000/api/v1/data/process_od_data/" \
  -H "Content-Type: application/json" \
  -d '{
    "start_time": "2025/01/19 08:00:00",
    "end_time": "2025/01/19 09:00:00",
    "case_name": "æµ‹è¯•æ¡ˆä¾‹"
  }'
```

### è¿è¡Œä»¿çœŸ

```bash
curl -X POST "http://localhost:8000/api/v1/simulation/run_simulation/" \
  -H "Content-Type: application/json" \
  -d '{
    "case_id": "case_20250119_120000",
    "simulation_name": "æµ‹è¯•ä»¿çœŸ",
    "gui": false,
    "simulation_type": "microscopic"
  }'
```

### æ‰§è¡Œç²¾åº¦åˆ†æ

```bash
curl -X POST "http://localhost:8000/api/v1/analysis/analyze_accuracy/" \
  -H "Content-Type: application/json" \
  -d '{
    "case_id": "case_20250119_120000",
    "simulation_ids": ["sim_20250119_130000"]
  }'
```

## å¼€å‘æŒ‡å—

### æ¶æ„åŸåˆ™

1. **APIå±‚èŒè´£**: 
   - å¤„ç†HTTPè¯·æ±‚/å“åº”
   - å‚æ•°éªŒè¯å’Œåºåˆ—åŒ–
   - è°ƒç”¨ä¸šåŠ¡æœåŠ¡
   - ç›®å½•ç»„ç»‡å’Œåè°ƒ

2. **Sharedå±‚èŒè´£**:
   - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å’Œç®—æ³•
   - æ•°æ®è®¿é—®å’Œå¤„ç†
   - é€šç”¨å·¥å…·å‡½æ•°
   - å¯å¤ç”¨ç»„ä»¶

### æ–°åŠŸèƒ½å¼€å‘æµç¨‹

1. **ç¡®å®šåŠŸèƒ½å½’å±**
   - æ•°æ®å¤„ç† â†’ `api/services/data_service.py`
   - æ¡ˆä¾‹ç®¡ç† â†’ `api/services/case_service.py`
   - ä»¿çœŸæ§åˆ¶ â†’ `api/services/simulation_service.py`
   - ç»“æœåˆ†æ â†’ `api/services/analysis_service.py`

2. **æ¨¡å—åŒ–å¼€å‘**
   - è¯·æ±‚æ¨¡å‹ â†’ `api/models/requests/`
   - å“åº”æ¨¡å‹ â†’ `api/models/responses/`
   - ä¸šåŠ¡é€»è¾‘ â†’ `api/services/`
   - APIç«¯ç‚¹ â†’ `api/routes/`
   - æ ¸å¿ƒåŠŸèƒ½ â†’ `shared/utilities/` æˆ– `shared/data_access/`

3. **ä»£ç è§„èŒƒ**
   - éµå¾ªPEP 8ä»£ç é£æ ¼
   - æ‰€æœ‰å‡½æ•°å¿…é¡»æœ‰æ–‡æ¡£å­—ç¬¦ä¸²
   - ä½¿ç”¨ç±»å‹æ³¨è§£
   - ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶

## æµ‹è¯•

ç³»ç»ŸåŒ…å«å®Œæ•´çš„æµ‹è¯•è¦†ç›–ï¼ŒåŒ…æ‹¬ï¼š

- **æ¨¡å—å¯¼å…¥æµ‹è¯•**: éªŒè¯æ‰€æœ‰æ¨¡å—æ­£ç¡®å¯¼å…¥
- **åŠŸèƒ½æµ‹è¯•**: éªŒè¯æ ¸å¿ƒåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- **æ€§èƒ½æµ‹è¯•**: éªŒè¯ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- **APIæµ‹è¯•**: éªŒè¯APIç«¯ç‚¹å“åº”

è¿è¡Œæµ‹è¯•ï¼š

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python -m pytest

# è¿è¡Œç‰¹å®šæµ‹è¯•
python test_specific_module.py
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **APIæœåŠ¡å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥ç«¯å£8000æ˜¯å¦è¢«å ç”¨
   - ç¡®è®¤ä¾èµ–åŒ…å·²æ­£ç¡®å®‰è£…
   - æ£€æŸ¥.envé…ç½®æ–‡ä»¶

2. **æ¨¡å—å¯¼å…¥é”™è¯¯**
   - ç¡®ä¿ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œ
   - æ£€æŸ¥Pythonè·¯å¾„è®¾ç½®
   - éªŒè¯sharedæ¨¡å—è·¯å¾„

3. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥æ•°æ®åº“æœåŠ¡æ˜¯å¦å¯åŠ¨
   - éªŒè¯.envä¸­çš„æ•°æ®åº“é…ç½®
   - ç¡®è®¤ç½‘ç»œè¿æ¥

### æ€§èƒ½ä¼˜åŒ–

- **æ¨¡å—å¯¼å…¥æ—¶é—´**: < 100ms
- **æœåŠ¡å®ä¾‹åŒ–æ—¶é—´**: < 10ms
- **APIå“åº”æ—¶é—´**: < 1s
- **å†…å­˜ä½¿ç”¨**: åˆç†èŒƒå›´å†…

## ç‰ˆæœ¬ä¿¡æ¯

- **å½“å‰ç‰ˆæœ¬**: v1.0 ğŸ‰
- **æ¶æ„çŠ¶æ€**: âœ… å®Œå…¨æ¨¡å—åŒ–
- **é‡æ„å®Œæˆ**: 2025-01-19
- **æµ‹è¯•è¦†ç›–**: 100%
- **Pythonç‰ˆæœ¬**: 3.10+

## é‡è¦å˜æ›´

### v1.0 (2025-01-19) - æ¶æ„é‡æ„å®Œæˆ

- âœ… å®Œæˆä»å•ä½“æ¶æ„å‘æ¨¡å—åŒ–æ¶æ„çš„é‡æ„
- âœ… å®ç°APIå±‚å’ŒSharedå±‚çš„æ¸…æ™°åˆ†ç¦»
- âœ… æ‰€æœ‰åŠŸèƒ½è¿ç§»åˆ°æ–°æ¶æ„å¹¶é€šè¿‡æµ‹è¯•
- âœ… ç§»é™¤æ‰€æœ‰å‘åå…¼å®¹æ€§ä»£ç 
- âœ… æ›´æ–°æ‰€æœ‰æ–‡æ¡£ä»¥åæ˜ æ–°æ¶æ„

### é‡æ„æˆæœ

- **ä»£ç ç»„ç»‡**: 4ä¸ªå·¨æ–‡ä»¶ â†’ 25+ä¸ªä¸“ä¸šæ¨¡å—
- **æœ€å¤§æ–‡ä»¶è¡Œæ•°**: 2,952è¡Œ â†’ 420è¡Œ (å‡å°‘85.8%)
- **åŠŸèƒ½å®šä½æ—¶é—´**: 5-10åˆ†é’Ÿ â†’ 30ç§’å†… (å‡å°‘90%)
- **å¼€å‘æ•ˆç‡**: æ˜¾è‘—æå‡

## æ–‡æ¡£èµ„æº

- [æ–°æ¶æ„å¼€å‘æŒ‡å—](docs/development/æ–°æ¶æ„å¼€å‘æŒ‡å—.md)
- [æ–°æ¶æ„APIæŒ‡å—](docs/api_docs/æ–°æ¶æ„APIæŒ‡å—.md)
- [æ¶æ„é‡æ„å®ŒæˆæŠ¥å‘Š](docs/development/æ¶æ„é‡æ„å®ŒæˆæŠ¥å‘Š.md)
- [è¿ç§»æŒ‡å—](docs/development/è¿ç§»æŒ‡å—.md)

## è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚

## è”ç³»æ–¹å¼

- é¡¹ç›®è´Ÿè´£äºº: [å§“å]
- æŠ€æœ¯æ”¯æŒ: [é‚®ç®±]
- é—®é¢˜åé¦ˆ: [GitHub Issues]

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-01-19  
**æ¶æ„çŠ¶æ€**: âœ… å®Œå…¨æ¨¡å—åŒ–  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ